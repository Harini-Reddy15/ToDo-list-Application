<!doctype html>
<html lang="en">

<head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
 
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
        <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200&icon_names=dark_mode" />
    <title>Hello, world!</title>
    <style>
        /* For tablets */
@media (max-width: 768px) {
    .container {
        flex-direction: column;
    }
}

/* For mobile devices */
@media (max-width: 480px) {
    .container {
        padding: 10px;
    }
}

    .highlight {
        background-color: white;
        color:black;
        font-weight: bold;
    
    }
    #darkIcon{
        color:black;
    }
    .dark-mode{
        background-color: rgb(47, 47, 47);
        color:white;
    }
    .dark-mode .table thead th {
color:white;
    } 
    .dark-mode .table tbody td {
color:white;
    } 
 
</style>
   
</head>

<body >
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
        crossorigin="anonymous"></script>
        


    <nav id="navbar" class="navbar  navbar-light bg-light" >
        <div class="container-fluid">
            <a class="navbar-brand" href="#">TODO List</a>
           
           
    
                
                 
                    <span onclick="darkMode()" id="darkIcon" class="material-symbols-outlined me-3" style="cursor: pointer;">
                        dark_mode
                    </span>
              
                <form class="d-flex" role="search">
                    <div class="search-container">
                        <input class="form-control me-2" 
                        oninput="searchTasks()" 
                        type="text"
                        id="searchBar"
                         placeholder="Search Tasks" 
                         >
                    </div>
                   
                    <button class="btn btn-outline-success" type="submit">Search</button>
                </form>
       
       </div>
    </nav>
    <h2 class="text-center my-4">Your tasks</h2>
    <div class="container my-4">
<div class="p-3 mb-2 ">

        <div class="form-group my-4">
            <label for="task">TASK TITLE</label>
            <input type="text" class="form-control" id="task" aria-describedby="emailHelp"
                placeholder="WATER THE PLANTS">
        </div>
        <div class="form-group my-4">
            <label for="description">Description</label>
            <textarea row=2 class="form-control" id="description"
                placeholder="watering the plants today by evening 4pm. "></textarea>
        </div>
        <div class="form-group my-4">
            <label for="deadline">Dead line</label>
            <input type="date" class="form-control" id="deadline" aria-describedby="emailHelp"
                placeholder="dd/mm/yyyy">
        </div>
        <button type="submit" id="add" class="btn btn-primary">Add to list</button>
        <button type="submit" id="cleared" class="btn btn-primary" onclick="cleared()">Clear the list</button>

        <div id="items"  class="my-4">
            <h3>Your items</h3>
            <table class="table">
                <thead>
                    <tr>
                        <th scope="col">Check</th>
                        <th scope="col">S.no</th>
                        <th scope="col">Task title</th>
                        <th scope="col">Task description</th>
                        <th scope="col">Dead line</th>
                        <th scope="col">Actions</th>
                    </tr>
                </thead>
                <tbody id="tableBody">
                    <tr>
                        <td><input type="checkbox" ></td>
                        <td>1</td>
                        <td>get me a coffee</td>
                        <td>from a shop</td>
                        <td>11/2/2025</td>
                        <td><button class="btn btn-primary"  type="submit">Delete</button>
                            <button class="btn btn-primary" type="submit">Edit</button</td>
                    </tr>

                </tbody>
            </table>
        </div>
        
    </div>

    <!-- Optional JavaScript; choose one of the two! -->

    <!-- Option 1: Bootstrap Bundle with Popper -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM"
        crossorigin="anonymous"></script>

    <!-- Option 2: Separate Popper and Bootstrap JS -->
    <!--
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.2/dist/umd/popper.min.js" integrity="sha384-IQsoLXl5PILFhosVNubq5LC7Qb9DXgDA9i+tQ8Zj3iwWAwPtgFTxbJ8NT4GN1R8p" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.min.js" integrity="sha384-cVKIPhGWiC2Al4u+LWgxfKTRIcfu0JTxR+EQDz/bgldoEyl4H0zUF0QKbrJ0EcQF" crossorigin="anonymous"></script>
    -->
    <script>
        function darkMode(){
            const element = document.body;
            element.classList.toggle("dark-mode");
           
        }
        function editItem(itemIndex) {
            itemJsonArrayStr = localStorage.getItem("itemsJson");
            itemJsonArray = JSON.parse(itemJsonArrayStr);

            // Populate the input fields with the selected item's values
            document.getElementById("task").value = itemJsonArray[itemIndex][0];
            document.getElementById("description").value = itemJsonArray[itemIndex][1];
            document.getElementById("deadline").value = itemJsonArray[itemIndex][2];

            // Add a temporary "Save" button for editing
            const saveButton = document.createElement("button");
            saveButton.className = "btn btn-success my-2";
            saveButton.textContent = "Save Changes";
            saveButton.onclick = function () {
                saveChanges(itemIndex, saveButton);
            };

            // Add the Save button below the input fields if it doesn't already exist
            if (!document.getElementById("saveButton")) {
                saveButton.id = "saveButton";
                document.querySelector(".container").appendChild(saveButton);
            }
        }

        function saveChanges(itemIndex, saveButton) {
            const updatedTitle = document.getElementById("task").value.trim();
            const updatedDescription = document.getElementById("description").value.trim();
            const updatedDeadline = document.getElementById("deadline").value.trim();
            if (updatedTitle === "" || updatedDescription === "" || updatedDeadline==="") {
                alert("Please fill out both fields before saving.");
                return;
            }

            itemJsonArrayStr = localStorage.getItem("itemsJson");
            itemJsonArray = JSON.parse(itemJsonArrayStr);
            itemJsonArray[itemIndex] = [updatedTitle, updatedDescription,updatedDeadline];
            localStorage.setItem("itemsJson", JSON.stringify(itemJsonArray));

           
            document.getElementById("task").value = "";
            document.getElementById("description").value = "";
            document.getElementById("deadline").value = "";
            saveButton.remove();

            update();
        }
        function getAndUpdate() {
            tit = document.getElementById("task").value.trim();
            desc = document.getElementById("description").value.trim();
            deadline = document.getElementById("deadline").value;
            if (tit === "" || desc === "" || deadline === "" ) {
                alert("please enter both task,description and deadline!!");
                return;
            }
            if (localStorage.getItem('itemsJson') == null) {
                
                itemJsonArray = [];
                itemJsonArray.push([tit, desc, deadline, false]);
                localStorage.setItem('itemsJson', JSON.stringify(itemJsonArray))
            }
            else {
                itemJsonArrayStr = localStorage.getItem('itemsJson')
                itemJsonArray = JSON.parse(itemJsonArrayStr)
                itemJsonArray.push([tit, desc, deadline, false]);
                localStorage.setItem('itemsJson', JSON.stringify(itemJsonArray))
            }
            document.getElementById("task").value = "";
            document.getElementById("description").value = "";
            document.getElementById("deadline").value = "";
            update();
        }
        function update() {

            if (localStorage.getItem('itemsJson') == null) {
                console.log("Updating events....")
                itemJsonArray = [];
               
                localStorage.setItem('itemsJson', JSON.stringify(itemJsonArray))
            }
            else {
                itemJsonArrayStr = localStorage.getItem('itemsJson')
                itemJsonArray = JSON.parse(itemJsonArrayStr)
            }

            //populate the table
            tableBody = document.getElementById('tableBody');
            let str = "";
        
            itemJsonArray.forEach((element, index) => {
                const [title, description, deadline, isChecked] = element;
                const remainingDays = calculateRemainingDays(deadline);
        const tooltip = remainingDays > 0 
            ? `${remainingDays} day(s) left to complete this task` 
            : "Deadline has passed";

                const checkedAttribute = isChecked ? "checked" : "";
                const textDecoration = isChecked ? "text-decoration: line-through;" : "";
                const buttonDisabled = isChecked ? "disabled" : "";
                
                str += `
    <tr>
        <td><input type="checkbox" onclick="toggleTask(${index})" ${checkedAttribute}></td>  
        <th scope="row">${index + 1}</th>
        <td style="${textDecoration}">${element[0]}</td>
        <td style="${textDecoration}">${element[1]}</td>
        <td style="${textDecoration}" title="${tooltip}">${deadline}</td>
        <td><button class="btn btn-primary" onclick="deleted(${index})" ${buttonDisabled} type="submit">Delete</button>
        <button class="btn btn-primary" onclick="editItem(${index})" ${buttonDisabled} type="submit">Edit</button></td>
        </tr>`;
        
            });
            
            tableBody.innerHTML = str;
        }
        function calculateRemainingDays(deadline) {
    const today = new Date();
    const taskDeadline = new Date(deadline);

    // Calculate the difference in milliseconds and convert to days
    const diffInTime = taskDeadline - today;
    const diffInDays = Math.ceil(diffInTime / (1000 * 60 * 60 * 24));

    return diffInDays;
}
        function toggleTask(itemIndex) {
            itemJsonArrayStr = localStorage.getItem("itemsJson");
            itemJsonArray = JSON.parse(itemJsonArrayStr);

            // Toggle the checkbox state
            itemJsonArray[itemIndex][3] = !itemJsonArray[itemIndex][3];
            localStorage.setItem("itemsJson", JSON.stringify(itemJsonArray));

            update();
        }
        add = document.getElementById("add");
        add.addEventListener("click", getAndUpdate)
        update();
        function deleted(itemIndex) {
            console.log('Delete', itemIndex);
            itemJsonArrayStr = localStorage.getItem('itemsJson')
            itemJsonArray = JSON.parse(itemJsonArrayStr)
            itemJsonArray.splice(itemIndex,1)
            localStorage.setItem('itemsJson', JSON.stringify(itemJsonArray))
            update();
        }
        function cleared() {
            if (confirm("do you want to clear?")) {
                localStorage.clear();
                update();
            }
        }
        function searchTasks() {
    const searchInput = document.getElementById("searchBar").value.toLowerCase();
    const tableRows = document.querySelectorAll("#tableBody tr");

    tableRows.forEach(row => {
        const titleCell = row.cells[2]; // Task Title (column index 2)
        const descriptionCell = row.cells[3]; // Task Description (column index 3)

        const titleText = titleCell.innerText.toLowerCase();
        const descriptionText = descriptionCell.innerText.toLowerCase();

        // Reset content to remove old highlights
        titleCell.innerHTML = titleCell.innerText;
        descriptionCell.innerHTML = descriptionCell.innerText;

        if (titleText.includes(searchInput) || descriptionText.includes(searchInput)) {
            row.style.display = ""; // Show matching row

            // Highlight the matching parts
            highlightText(titleCell, searchInput);
            highlightText(descriptionCell, searchInput);
        } else {
            row.style.display = "none"; // Hide non-matching row
        }
    });
}

function highlightText(cell, searchInput) {
    const cellText = cell.innerText;
    const regex = new RegExp(`(${searchInput})`, "gi"); // Case-insensitive match
    cell.innerHTML = cellText.replace(regex, `<span class="highlight">$1</span>`);
}


    </script>
</body>

</html>